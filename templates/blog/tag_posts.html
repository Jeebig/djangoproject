{% extends 'blog/base.html' %}

{% block main %}
<div class="page-header">
    <h1>Posts tagged with "{{ tag.name }}"</h1>
    {% if page_obj.paginator.num_pages > 1 %}
    <p class="text-muted">Страница {{ page_obj.number }} из {{ page_obj.paginator.num_pages }}</p>
    {% endif %}
</div>

{% for post in posts %}
<!-- Blog Post -->
<h2>
    <a href="{% url 'blog:post-detail-slug' post.slug %}">{{ post.title }}</a>
</h2>
{% if post.tags.all %}
<p class="tags">
    <strong>Теги:</strong>
    {% for tag_item in post.tags.all %}
    <a href="{% url 'blog:tag-posts' tag_item.name %}" class="label label-primary">{{ tag_item.name }}</a>
    {% endfor %}
</p>
{% endif %}
<p class="lead">
    by <a href="#">{{ post.author.username }}</a> in <a href="{% url 'blog:category-posts' post.category.slug %}">{{ post.category.name }}</a>
</p>
<p><span class="glyphicon glyphicon-time"></span> Posted on {{ post.created_at|date:"F d, Y H:i" }}</p>
<hr>
{% with first_image=post.images.all|first %}
    {% if first_image and first_image.thumbnail %}
    <img class="img-responsive" src="{{ first_image.thumbnail.url }}" alt="{{ post.title }}" loading="lazy" decoding="async">
    {% elif post.image %}
    <img class="img-responsive" src="{{ post.image }}" alt="{{ post.title }}" loading="lazy" decoding="async">
    {% else %}
    <img class="img-responsive" src="https://via.placeholder.com/900x300" alt="placeholder" loading="lazy" decoding="async">
    {% endif %}
{% endwith %}
<hr>

<p>{{ post.content|truncatewords:30 }}</p>
<a class="btn btn-primary" href="{% url 'blog:post-detail-slug' post.slug %}">Read More <span
        class="glyphicon glyphicon-chevron-right"></span></a>
<hr>
{% empty %}
<p>No posts found with this tag.</p>
{% endfor %}

<!-- Пагинация -->
{% if page_obj.has_other_pages %}
<hr>
<ul class="pager">
    {% if page_obj.has_next %}
    <li class="previous">
        <a href="?page={{ page_obj.next_page_number }}">&larr; Older</a>
    </li>
    {% endif %}
    {% if page_obj.has_previous %}
    <li class="next">
        <a href="?page={{ page_obj.previous_page_number }}">Newer &rarr;</a>
    </li>
    {% endif %}
</ul>
{% endif %}

{% endblock %}