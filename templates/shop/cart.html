{% extends 'blog/base.html' %}
{% block main %}
<h2 class="mb-4">Корзина</h2>

<div class="row g-4">
  <div class="col-lg-8">
    <div class="table-responsive">
      <table id="cart-table" class="table align-middle {% if not items %}d-none{% endif %}">
        <thead>
          <tr>
            <th>Товар</th>
            <th class="w-25">Количество</th>
            <th>Сумма</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        {% for it in items %}
          <tr>
            <td>
              <div class="fw-semibold">{{ it.product.name }}</div>
              <div class="text-muted small">{{ it.product.price }} ₴ / шт.</div>
            </td>
            <td>
              <div class="input-group input-group-sm cart-qty">
                <form method="post" action="{% url 'shop:cart-update' it.product.id %}" class="d-flex w-100">{% csrf_token %}
                  <button type="submit" class="btn btn-outline-secondary" name="qty" value="{{ it.qty|add:-1 }}" data-cart-minus data-url="{% url 'shop:cart-update' it.product.id %}" data-qty="{{ it.qty|add:-1 }}" {% if it.qty <= 1 %}disabled{% endif %} title="Уменьшить">−</button>
                  <label for="qty-{{ it.product.id }}" class="visually-hidden">Количество</label>
                  <input id="qty-{{ it.product.id }}" class="form-control text-center" type="number" name="qty" min="0" value="{{ it.qty }}" aria-label="Количество">
                  <button type="submit" class="btn btn-outline-secondary" name="qty" value="{{ it.qty|add:1 }}" data-cart-plus data-url="{% url 'shop:cart-update' it.product.id %}" data-qty="{{ it.qty|add:1 }}" title="Увеличить">+</button>
                </form>
              </div>
            </td>
            <td class="fw-semibold" data-subtotal>{{ it.subtotal }} ₴</td>
            <td>
              <form method="post" action="{% url 'shop:cart-remove' it.product.id %}">{% csrf_token %}
                <button class="btn btn-sm btn-outline-danger" type="submit" data-cart-remove data-url="{% url 'shop:cart-remove' it.product.id %}">Удалить</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
    <a class="btn btn-outline-secondary" href="{% url 'shop:product-list' %}">← Продолжить покупки</a>
  </div>
  <div class="col-lg-4">
    <div id="cart-summary" class="card cart-summary {% if not items %}d-none{% endif %}">
      <div class="card-body">
        <h5 class="card-title">Итого</h5>
        <div class="d-flex justify-content-between mb-3">
          <span>К оплате:</span>
          <span id="cart-total" class="fw-bold">{{ total }} ₴</span>
        </div>
        <form class="d-inline" method="post" action="{% url 'shop:cart-clear' %}">{% csrf_token %}
          <button class="btn btn-outline-secondary w-100 mb-2" type="submit" data-cart-clear data-url="{% url 'shop:cart-clear' %}">Очистить корзину</button>
        </form>
        <a class="btn btn-primary w-100" href="{% url 'shop:checkout' %}">Оформить заказ</a>
      </div>
    </div>
  </div>
  <div id="cart-empty" class="cart-empty {% if items %}d-none{% endif %}">
    <div class="icon"><i class="bi bi-cart"></i></div>
    <h4 class="mt-3">Ваша корзина пуста</h4>
    <p>Добавьте товары из каталога магазина.</p>
    <a class="btn btn-primary" href="{% url 'shop:product-list' %}"><i class="bi bi-bag"></i> Перейти в магазин</a>
  </div>
</div>
{% endblock %}
{% block sidebar %}{% endblock %}
